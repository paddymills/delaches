<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />
    <link rel="stylesheet" href="/style/base.css" />
    <link rel="stylesheet" href="/style/table.css" />
    <script defer src="/assets/alpine.min.js"></script>
    <title>Delaches Member Management</title>
  </head>
  <body>
    <noscript>This webpage requires javascript to run.</noscript>
    <main x-data="table">
      <input type="text" x-model="searchTerm" x-effect="search()" />
      <table>
        <thead class="ocean-gradient">
          <tr>
            <th>Member ID</th>
            <th>Card ID</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Address</th>
            <th>City</th>
            <th>State</th>
            <th>Zip</th>
            <th>Due</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="(member, index) in members">
            <tr>
              <td x-text="member.MemberId"></td>
              <td x-text="member.CardId"></td>
              <td x-text="member.FirstName"></td>
              <td x-text="member.LastName"></td>
              <td x-text="member.Address1"></td>
              <td x-text="member.City"></td>
              <td x-text="member.State"></td>
              <td x-text="member.Zip"></td>
              <td><button>Pay</button></td>
            </tr>
          </template>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="100">pagination and such</td>
          </tr>
        </tfoot>
      </table>
    </main>
  </body>
  <script>
    function findIn(x, term) {
      return x != null && x.toString().toLowerCase().includes(term);
    }
    document.addEventListener("alpine:init", () => {
      Alpine.data("table", () => ({
        _members: [],
        members: [],
        searchTerm: "",

        async init() {
          let response = await fetch("/members?active=true");

          this._members = await response.json();
          console.log(this._members);
        },

        search() {
          const term = this.searchTerm.toLowerCase();

          this.members = this._members.filter((m) => {
            return (
              findIn(m.MemberId, term) ||
              findIn(m.CardId, term) ||
              findIn(m.FirstName, term) ||
              findIn(m.LastName, term) ||
              findIn(m.Address1, term) ||
              findIn(m.Address2, term) ||
              findIn(m.City, term) ||
              findIn(m.State, term) ||
              findIn(m.Zip, term) ||
              findIn(m.Phone1, term) ||
              findIn(m.Phone2, term) ||
              findIn(m.Email, term)
            );
          });
        },
      }));
    });
  </script>
</html>
